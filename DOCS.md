# é’‰é’‰è‡ªå®šä¹‰æœºå™¨äººï¼Œå¼€å‘ä¸€ä¸ªè‡ªåŠ¨ç‚¹é¤çš„ç³»ç»Ÿ

> é¦–å…ˆï¼Œæˆ‘æ˜¯ä¸€ä¸ªå‰ç«¯é¡µé¢ä»”ï¼ŒJava æ˜¯è‡ªå­¦çš„ï¼Œæ‰€ä»¥æœ‰ä»€ä¹ˆä»£ç å…¥ä¸äº†å„ä½å¤§ä½¬çš„çœ¼ï¼Œå¸Œæœ›æŒ‡å‡ºï¼Œé‚£å¯èƒ½å°±æ˜¯æˆ‘å°†æ¥åŠ è–ªçš„é‡è¦çš„ä¸€åˆ†ï¼Œä¸‡åˆ†æ„Ÿè°¢ï¼ğŸ™ã€‚å…¶æ¬¡ï¼Œæ¯å¤©ä¸­åˆæˆ‘ä»¬è€å¤§å«æˆ‘ä»¬ç‚¹èœï¼Œå½“ä½ åœ¨å¤„ç† bug æœ‰å¤´ç»ªçš„æ—¶å€™çªç„¶å°±ç»™ä½ æ‰“æ–­äº†ï¼Œæœ€å…³é”®çš„æ˜¯ä½ ä¹Ÿä¸çŸ¥é“åƒä»€ä¹ˆï¼Œä½ è¯´æ°”ä¸æ°”ï¼Œä¸€æ°”ä¹‹ä¸‹ï¼Œå†™äº†è¿™ä¸ªç‚¹é¤ç³»ç»Ÿï¼Œç„¶åè‡ªåŠ¨ç‚¹é¤å‘é€åˆ°ç¾¤é‡Œï¼Œå¦‚æœæœ‰ä¸æ»¡æ„çš„è¿˜å¯ä»¥é‡æ–°ç‚¹ä¸€ä»½ï½

## åŠŸèƒ½

1.å·¥ä½œæ—¥æœŸé—´æ¯å¤©ä¸Šåˆ 11 ç‚¹å‡†æ—¶ç‚¹é¤æœºå™¨äººå‘é€åˆ°é’‰é’‰ç¾¤

2.å¦‚æœç³»ç»Ÿç‚¹é¤ä¸æ»¡æ„å¯ä»¥å»ç‚¹é¤é¦–é¡µåœ¨æ‰‹åŠ¨ç‚¹é¤ä¸€æ¬¡ï¼Œå¯ä»¥é€‰æ‹©å°±é¤äººæ•°ï¼Œè¤èœæ•°ç­‰ï¼Œä¸”æ‰‹åŠ¨ç‚¹é¤åä¼šè®°å½•æ­¤æ¬¡ç‚¹é¤çš„çŠ¶æ€æ¯”å¦‚ï¼šäººæ•°ã€è¤èœæ•°ç­‰ï¼Œä¸‹æ¬¡ç³»ç»Ÿç‚¹é¤ä¼šæŒ‰ç…§æ­¤æ¬¡é…ç½®è¿›è¡Œç‚¹é¤

3.å¦‚æœæœ‰åŒäº‹ä¸å–œæ¬¢åƒçš„èœæˆ–è€…é¤é¦†ä¸‹æ¶çš„èœå“ï¼Œå¯ä»¥åœ¨èœå•åˆ—è¡¨å»å–æ¶ˆå‹¾é€‰ï¼Œé‚£ä¹ˆä¸ç®¡æ˜¯ç³»ç»Ÿç‚¹é¤è¿˜æ˜¯æ‰‹åŠ¨ç‚¹é¤éƒ½ä¸ä¼šåœ¨å‡ºç°åœ¨ç‚¹é¤çš„åˆ—è¡¨ä¸Š

4.ä¼˜åŒ–ä¸å‡ºç°åŒåèœå“ï¼Œæ¯”å¦‚`ä»”å§œè‚‰ä¸`å’Œ`é±¼é¦™è‚‰ä¸`éƒ½æ˜¯è‚‰ä¸ï¼Œé‚£ä¹ˆç³»ç»Ÿå°±ä¼šå¤„ç†åªä¼šå‡ºç°ä¸€ä¸ªè‚‰ä¸

|               é’‰é’‰æ¶ˆæ¯ç•Œé¢               |                   ç‚¹é¤é¦–é¡µ                   |                 èœå•åˆ—è¡¨                  |
| :--------------------------------------: | :------------------------------------------: | :---------------------------------------: |
| ![](http://file.weilkss.cn/IMG_1324.png) | ![](http://file.weilkss.cn/dingtalkhome.png) | ![](http://file.weilkss.cn/diacan-03.gif) |

## æ·»åŠ æœºå™¨äºº

[å®˜æ–¹æ–‡æ¡£](https://ding-doc.dingtalk.com/doc#/serverapi2/qf2nxq) å†™å¾—å¾ˆæ¸…æ¥šï¼Œæˆ‘è¿™é‡Œå°±ä¸å†™æ·»åŠ æ­¥éª¤äº†ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯å®‰å…¨è®¾ç½®ï¼Œè¿™é‡Œä¸€èˆ¬é€‰æ‹©å…³é”®å­—å°±è¡Œï¼Œæ˜¯æ¯”è¾ƒçœå¿ƒçš„åšæ³•ï½

## æ–°å»ºé¡¹ç›® SpringBoot æ•´åˆ mybatis(XML é…ç½®æ–‡ä»¶)

æ–°å»º `SpringBoot` æˆ‘è¿™é‡Œå°±ä¸æ“ä½œäº†,ç›´æ¥æ¥çœ‹ä¸‹ `pom.xml` çš„é…ç½®

### é…ç½® web æ ¸å¿ƒä¾èµ–

ä¸»è¦æ˜¯æœ‰éƒ¨åˆ†é¡µé¢ï¼Œç‚¹é¤å’Œèœå•é¡µé¢

```xml
<dependency>
  <groupId>org.springframework.boot</groupId>
  <artifactId>spring-boot-starter-web</artifactId>
</dependency>
```

### mysql æ•°æ®åº“é©±åŠ¨ å’Œ mybatis

```xml
<dependency>
  <groupId>mysql</groupId>
  <artifactId>mysql-connector-java</artifactId>
  <scope>runtime</scope>
</dependency>

<dependency>
    <groupId>org.mybatis.spring.boot</groupId>
    <artifactId>mybatis-spring-boot-starter</artifactId>
    <version>2.1.0</version>
</dependency>
```

### é…ç½®æœ¬åœ° dingtalk ä¾èµ–æ’ä»¶

è¿™ä¸ªæ˜¯é’‰é’‰è‡ªå®šä¹‰æœºå™¨äººçš„ä¾èµ–åŒ…ï¼Œ[ä¸‹è½½åœ°å€](https://ding-doc.dingtalk.com/doc#/faquestions/vzbp02/8DMhu)ï¼Œé¦–å…ˆåœ¨æ ¹ç›®å½•ä¸‹å»ºä¸€ä¸ª `libs` çš„æ–‡ä»¶å¤¹ï¼ŒæŠŠä¸‹è½½å¥½çš„ `SDK` æ”¾åˆ° `libs` ä¸‹ï¼Œåœ¨ `pom.xml` åšä¸€ä¸‹é…ç½®

```xml
<dependency>
  <groupId>com.dingtalk.open</groupId>
  <artifactId>taobao-sdk-java</artifactId>
  <version>1.0.0-SNAPSHOT</version>
  <scope>system</scope>
  <systemPath>${project.basedir}/libs/dingtalk-sdk-java/taobao-sdk-java-auto.jar</systemPath>
</dependency>
```

è¦åœ¨ `<build>` é‡Œé¢åŠ å…¥ `<configuration>` é…ç½®,ä¸ç„¶çš„è¯æ‰“åŒ…å‘å¸ƒåˆ°æœåŠ¡å™¨æ‰¾ä¸åˆ°æœ¬åœ°ä¾èµ–æ’ä»¶çš„

```xml
<build>
  <plugins>
    <plugin>
      <groupId>org.springframework.boot</groupId>
      <artifactId>spring-boot-maven-plugin</artifactId>
      <configuration>
        <fork>true</fork>
        <includeSystemScope>true</includeSystemScope>
      </configuration>
    </plugin>
  </plugins>
</build>
```

## æ•°æ®åº“

`foods` è¡¨ç»“æ„

![](http://file.weilkss.cn/æˆªå±2020-07-2414.53.53.png)

`params` è¡¨ç»“æ„

![](http://file.weilkss.cn/æˆªå±2020-07-2414.54.09.png)

## WebController web é¡µé¢æ§åˆ¶å™¨

```java
@Controller
@RequestMapping("/diancan")
public class WebController {
    @Autowired
    private ParamsService paramsService;

    @RequestMapping()
    public String getIndex(ModelMap map) {
        /**
         * è·å–æœåŠ¡å™¨æ—¶é—´
         */
        Date date = new Date();
        SimpleDateFormat dateFormat = new SimpleDateFormat("yyyy-MM-dd");
        map.addAttribute("curTime", dateFormat.format(date));
        /**
         * è·å–params
         */
        List<Params> paramsObject = paramsService.finds();
        map.addAttribute("params", paramsObject.get(0));

        return "index";
    }

    /**
     * è¿”å›foodsåˆ—è¡¨
     */
    @Autowired
    private FoodsService foodsService;

    @RequestMapping("/foods")
    public String getFoodsHtml(ModelMap map){
        List<Foods> list = foodsService.findFoods();

        JSONArray maxFoods = new JSONArray();
        JSONArray meatFoods = new JSONArray();
        JSONArray cheapFoods = new JSONArray();
        JSONArray soupFoods = new JSONArray();

        for(int i = 0;i<list.size();i++){
            Integer type = list.get(i).getType();

            if(type == 1){
                maxFoods.add(list.get(i));
            }else if(type == 2){
                meatFoods.add(list.get(i));
            }else if(type ==3){
                cheapFoods.add(list.get(i));
            }else{
                soupFoods.add(list.get(i));
            }
        }

        map.addAttribute("maxFoods",maxFoods);
        map.addAttribute("meatFoods",meatFoods);
        map.addAttribute("cheapFoods",cheapFoods);
        map.addAttribute("soupFoods",soupFoods);
        return "foods";
    }
}

```

## ApiController

> è¿™é‡Œä¸»è¦æ˜¯æ›´æ–°çŠ¶æ€å’Œ foods çš„çŠ¶æ€çš„æ¥å£

æ•°æ®åº“çš„æ•°æ®ä½¿ç”¨ `mapper` æ³¨å…¥,åœ¨ `resources` ä¸­æ–°å»º `mapper` æ–‡ä»¶å¤¹,åœ¨é‡Œé¢æ˜¯ `*Mapper.xml` æ–‡ä»¶,æ‰€ä»¥è¦åœ¨ `application.properties` é…ç½®

```xml
mybatis.mapper-locations=classpath:mapper/*.xml
mybatis.type-aliases-package=cn.com.diancan.entity
mybatis.configuration.map-underscore-to-camel-case=true
```

è¦åœ¨å…¥å£æ³¨å…¥ `@MapperScan("cn.com.diancan.mapper")`

åœ¨ `mapper` ä¸­

```java
@Mapper
public interface FoodsMapper {
    List<Foods> findFoods();

    Integer updateFoods(@Param("fid") Integer fid,@Param("show") Integer show);

    List<Foods> findFoodsByType(@Param("type") Integer type);
}
```

`service` ä¸šåŠ¡å¤„ç†å±‚

```java
public interface FoodsService {
    List<Foods> findFoods();

    Integer updateFoods(Integer fid,Integer show);

    List<Foods> findFoodsByType(Integer type);
}
```

impl

```java

@Service("FoodsService")
public class FoodsServiceImpl implements FoodsService {
    @Autowired
    private FoodsMapper foodsMapper;

    @Override
    /**
     * è·å–æ‰€æœ‰çš„foods
     */
    public List<Foods> findFoods() {
        return foodsMapper.findFoods();
    }

    /**
     * æ›´æ”¹foodçš„çŠ¶æ€
     *
     * @param fid  foodId
     * @param show æ˜¯å¦æ˜¾ç¤º
     * @return Integer
     */
    public Integer updateFoods(Integer fid, Integer show) {
        return foodsMapper.updateFoods(fid, show);
    }

    /**
     * æ ¹æ®typeè·å–foodsåˆ—è¡¨
     *
     * @param type
     * @return
     */
    public List<Foods> findFoodsByType(Integer type) {
        return foodsMapper.findFoodsByType(type);
    }
}
```

çœ‹çœ‹ `FoodsMapper.xml`

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="cn.com.diancan.mapper.FoodsMapper">

    <select id="findFoods" resultType="Foods">SELECT * FROM foods</select>

    <update id="updateFoods" parameterType="Foods">
        UPDATE foods SET `show`=#{show} WHERE fid=#{fid}
    </update>

    <select id="findFoodsByType" resultType="Foods">SELECT * FROM foods WHERE `type`=#{type} AND `show`=1</select>
</mapper>
```

ä¸‹é¢ä»£ç  api æ˜¯ä¸ºäº†è®°å½•æ‰‹åŠ¨ç‚¹é¤åè®°å½•æœ¬æ¬¡çš„çŠ¶æ€

```java
@ResponseBody
@PostMapping(value = "/api/updateParams", produces = "application/json;charset=UTF-8")
public Result UpdateParams(@RequestBody JSONObject jsonObject) {
    Integer peopleNum = Integer.parseInt(jsonObject.get("peopleNum").toString());
    Integer meatNum = Integer.parseInt(jsonObject.get("meatNum").toString());
    Integer cheapNum = Integer.parseInt(jsonObject.get("cheapNum").toString());
    Integer soupNum = Integer.parseInt(jsonObject.get("soupNum").toString());

    Integer result = paramsService.updateParams(peopleNum, meatNum, cheapNum, soupNum);
    System.out.println(result);

    return Result.success();
}
```

ä»¥ä¸‹ä»£ç æ˜¯æ›´æ–°å½“å‰èœåæ˜¯å¦é€‰ä¸­ï¼Œå–æ¶ˆå‹¾é€‰ä¸‹æ¬¡ç‚¹èœå°±ä¸ä¼šå‡ºç°

```java
@ResponseBody
@PostMapping(value = "/api/updateFoodsByFid", produces = "application/json;charset=UTF-8")
public Result updateFoodsByFid(@RequestBody JSONObject jsonObject) {
    Integer fid = Integer.parseInt(jsonObject.get("fid").toString());
    Integer show = Integer.parseInt(jsonObject.get("show").toString());
    foodsService.updateFoods(fid, show);
    return Result.success();
}
```

## DingTalkController

å®ä¾‹åŒ– `dingTalkClient` å’Œ `request`

```java
private DingTalkClient dingTalkClient = new DefaultDingTalkClient(WebConstants.SERVER_URL);
private OapiRobotSendRequest request = new OapiRobotSendRequest();
```

æˆ‘è¿™é‡Œç”¨åˆ°äº† `text` å’Œ `Markdown` çš„æ¶ˆæ¯ç±»å‹

```java
/**
  * sendText
  */
public void sendText() throws ApiException {
    OapiRobotSendRequest.Text text = new OapiRobotSendRequest.Text();
    text.setContent(WebConstants.SEND_TEXT_CONTENT);
    OapiRobotSendRequest.At at = new OapiRobotSendRequest.At();
    at.setIsAtAll(true);
    request.setAt(at);
    request.setMsgtype("text");
    request.setText(text);
    dingTalkClient.execute(request);
}
```

```java
/**
  * sendMarkdown
  */
public void sendMarkdown() throws ApiException {
    OapiRobotSendRequest.Markdown markdown = new OapiRobotSendRequest.Markdown();
    markdown.setTitle(WebConstants.SEND_TEXT_TITLE);

    String text = buffer.toString();
    markdown.setText(text);

    request.setMsgtype("markdown");
    request.setMarkdown(markdown);

    dingTalkClient.execute(request);
}
```

æ ¸å¿ƒé€»è¾‘ï¼Œé€šè¿‡è·å–åˆ°çš„ `foods` ç„¶åæ ¹æ® `array` é•¿åº¦è·å–ä¸é‡å¤çš„éšæœºæ•°ï¼Œç„¶ååœ¨æ­£åˆ™åŒ¹é…æ˜¯å¦æœ‰åŒåèœï¼Œå¦‚æœæœ‰çš„åŒ–å°±é‡æ–°è·å–ä¸€ä¸ªèœï¼Œç›´åˆ°ä¸åŒå,æœ€ååœ¨å¾ªç¯æœ€ç»ˆè·å–çš„æ•°ç»„ï¼Œåœ¨é€šè¿‡ `StringBuffer` æ¥æ‹¼æ¥å­—ç¬¦ä¸²

### è·å–ä¸é‡å¤æŒ‡å®šé•¿åº¦çš„éšæœºæ•°ç»„

```java
/**
  * è·å–éšæœºæ•°
  *
  * @param max
  * @param len
  * @return rands
  */
public static int[] Randoms(int max, int len) {
    Random rand = new Random();
    int[] rands = new int[len];
    boolean[] bool = new boolean[max];
    int randint = 0;

    for (int i = 0; i < len; i++) {
        do {
            randint = rand.nextInt(max);
        } while (bool[randint]);
        bool[randint] = true;
        rands[i] = randint;
    }

    return rands;
}
```

### åˆ¤æ–­æ˜¯å¦æœ‰åŒåèœ

æŠŠé‡å¤çš„èœåæ”¾åˆ°ä¸€ä¸ªæ•°ç»„é‡Œï¼Œç„¶ååœ¨å¤„ç†è¿™ä¸ªæ•°ç»„æŠŠé‡å¤çš„èœåæ›¿æ¢æ‰

```java
String[] foodsKey = commonUtil.setFoodsKey();
String[] selectFoodsKey = new String[foodsChoiceArray.length];

for (int i = 0; i < foodsChoiceArray.length; i++) {
    for (int k = 0; k < foodsKey.length; k++) {
        String pattern = ".*" + foodsKey[k] + ".*";

        boolean isMatch = Pattern.matches(pattern, foodsChoiceArray[i].getString("name"));

        if (isMatch) {
            selectFoodsKey[i] = foodsKey[k];
            break;
        }
    }
}


int countKey = 0;
for (int j = 0; j < selectFoodsKey.length; j++) {
    for (int k = j + 1; k < selectFoodsKey.length; k++) {
        if (selectFoodsKey[j] == selectFoodsKey[k] & selectFoodsKey[j] != "null" & selectFoodsKey[k] != "null") {
            countKey++;
        }
    }

    if (countKey == 1) {
        boolean isMatch = false;
        if (foodsChoiceArray[j].getString("type") == "2") {
            do {
                foodsChoiceArray[j] = commonUtil.getFoodsArray(1, meatFoods)[0];
                String pattern = ".*" + selectFoodsKey[j] + ".*";
                String name = foodsChoiceArray[j].getString("name");
                isMatch = Pattern.matches(pattern, name);

            } while (isMatch);

        } else if (foodsChoiceArray[j].getString("type") == "3") {
            do {
                foodsChoiceArray[j] = commonUtil.getFoodsArray(1, cheapFoods)[0];
                String pattern = ".*" + selectFoodsKey[j] + ".*";
                String name = foodsChoiceArray[j].getString("name");
                isMatch = Pattern.matches(pattern, name);

            } while (isMatch);
        }

        countKey = 0;
    }
}
```

æœ€åï¼šè¿™å—ä¼˜åŒ–æ˜¯åé¢å†™çš„ï¼Œæ˜¯å› ä¸ºä¹‹å‰ä¸€ç›´å‘ç°å‡ºç°åŒåèœï¼Œç„¶ååŒäº‹è¯´è¿™ä¸æ™ºèƒ½ï¼Œç„¶åæˆ‘æ‰æŠ½ç©ºé—²æ—¶é—´åšäº†è¿™å—ä¼˜åŒ–ï¼Œå°±ç›®å‰æ¥çœ‹ï¼Œæ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼è‡ªå·±å¾ˆå°‘å†™æ–‡ç« ï¼Œå¯¹é¡¹ç›®çš„è§£æå’Œæ€»ç»“ä¹Ÿå°±è¿™æ ·å­ï¼Œå¦‚æœæœ‰ä»€ä¹ˆé—®é¢˜æ¬¢è¿ [![](https://img.shields.io/github/issues/weilkss/OrderingFoods)](https://github.com/weilkss/OrderingFoods/issues) å¦‚æœä½ è§‰å¾—å¯¹ä½ æœ‰å¸®åŠ©æ¬¢è¿ [![](https://img.shields.io/github/stars/weilkss/OrderingFoods?style=social)](https://github.com/weilkss/OrderingFoods)
